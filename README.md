# gcf-myapp
GCF Simple Web application skeleton

This a simple skeleton application that includes all that you need to create basic web application using GCF Library:

## Structure

```
Myapp
│   composer.json
│   init.php
├───cfg
│   └───properties_dev.ini
├───app
├───data
│   └───models
└───frontal
    │   index.php
    │
    ├───cfg
    ├───modules
    ├───static
    │   ├───css
    │   ├───img
    │   └───jscript
    └───templates
            index.twig
```

On root that contains init.php to initialize application environment. In this example, only had simple index.php that initialize configuration envinronment and render simple TWIG template.

## Initialization program

```php
<?php

/**
 * Application initialization
 */

use gcf\Environment;

include __DIR__."/vendor/autoload.php";

try {
        $env = Environment::getInstance("MyAppName");
} catch (Exception $ex) {
        die($ex->getMessage());
}
```

This file is included on main php (p.e: index.php) program that initialize GCF context.

And composer.json that contains project dependencies and general configuration. This file autogenerated with composer init

```json
{
    "name": "tomeu/myapp",
    "description": "Example application",
    "type": "project",
    "license": "GPL",
    "authors": [
        {
            "name": "Tomeu Capó",
            "email": "tomeucapo@gmail.com"
        }
    ],
    "minimum-stability": "stable",
    "require": {}
}
```

## Environment configuration

It is necessary to define variables in the operating system scope so that the application knows in which environment it is located and where the main configuration file is:

Variable name | Description
------------ | -------------
APPS_ENVIRONMENT_ID | Environemnt identification (pre, prod, dev)
APPS_ENVIRONEMNT_CONF | Main application configuration directory
APP_NAME | Application name

Environment variales example:
```
APPS_ENVIRONMENT=Production
APPS_ENVIRONMENT_ID=prod
APPS_ENVIRONMENT_CONF=/etc/entorns/config/
APP_NAME=Personal
```

## Application properties file

The configuration file is structured with different sections: general, jobserver, cache, auth, tserver, ...
The application expects to find the configuration by considering the `APPS_ENVIRONMENT_CONF`, `APP_NAME` and `APPS_ENVIRONMENT_ID` variables.

`<APPS_ENVIRONMENT_CONF>/<APP_NAME>/properties_<APPS_ENVIRONENT_ID>.ini`

```
; General configuration
[general]
;databases         = myappdb
;maindb            = myappdb
template_engines  = twigEngine

; Cache backend connection
[cache]
type=redis
host=127.0.0.1
port=6379
dbindex=1

; Datastore for DataStoreModel
[datastore]
dbindex=2

;Job server
[jobserver]
type=Gearman
host=127.0.0.1
port=4730

[paths]
path.templates = "templates/"
path.imatges = "static/img/"

[logging]
loggers=general
general.log.writerName = "Stream"
general.log.writerParams.stream =  "../logs/general.log"
general.log.filterName = "Priority"
general.log.filterParams.priority = 3
general.log.filterParams.operator = ">="

;[myappdb]
;database.type            = firebird
;database.auth            = user
;database.params.host     = localhost
;database.params.username = SYSDBA
;database.params.password = masterkey
;database.params.dbname   = myappdb.fdb
;database.params.path     =
```
